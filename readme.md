# これは何

ラッピングして使ってきた組版のいろいろを整理

思い出しポイント

- [ ] サブシェルのexit
- [ ] Mac以外との互換性を高める
  - [ ] 環境構築がダルそう
  - [ ] MacOS以外の/tmp/の仕組みを知らない
  - [ ] Docker？
  - [ ] 実行権限渡すのを促す
    - [ ] シェルからシェルを呼ぶのにも必要
  - [ ] CURRENT_BRANCH取得するためにgit使ってる
  - [ ] 勝手に同期されるフォルダの中でブランチ切り替えるとよくないことが起こる
- [ ] trap
  - [ ] 途中で中断したとき，これまではキャッシュが残ってしまった
- [ ] キャッシュ
  - [ ] キャッシュするのは中間生成ファイルだけでよくない？
  - [ ] /tmp/に置くキャッシュは他のキャッシュを真似してbranchごとに分けてたのは正解っぽい
  - [ ] キャッシュがファイルを消した後も残りとても不便
- [ ] Boilerplate.texにパッケージの説明を追記
  - [ ] 深すぎるネストに対応
  - [ ] 2バイト文字から始まる名前がバグる

監視スクリプト

- ディレクトリ
  - Legacy systemの監視スクリプトはMarkdownしか見てなかった
    - 数式とか図とかの変化も監視したい
  - Legacy systemの監視スクリプトはファイル一つの変化だけでbreakしてた
    - 全部のファイルを上書きして解決してた
      - 効率が悪い
  - Legacy systemはMarkdownの中の，ゼロパディングで管理されたファイルしか見てなかった
  - Legacy systemでは短めの書類しか作ってこなかった
    - 章立てをディレクトリで分けて管理したい
  - Legacy systemではファイルを追加した途端に組版し始めてうざかった
  - 変化検知後，全てのファイルをコピーしてて効率が悪かった
    - ビルドスクリプトに渡して効率化できるはず
  - 引数
    - 注目するディレクトリを引数で指定
    - 引数がなければsrc内全部監視
  - 監視中に

<!--
- 情報
  - [ ] 前後（ビフォーアフター）
  - [ ] ディレクトリ（）target
    - [x] 番号
    - [x] イレギュラー・連想
  - [ ] バッファー　Target_1[target_0]=ハッシュ
    - [ ] ファイル名に新しく識別番号を割り振る，
    - [ ] 連想配列
    - [ ] target_0["aaa"]=1，インクリメント
    - [ ] 要素数分回す，回す点に関しては要素数だけが大事
    - [ ] 必要なのは要素数だけ
      - [ ] 要素数_1["${target}"]=インクリメントで数えた要素数
      - [ ] インクリメント必要？
  - [ ] 変化検知後は配列を初期化

  - [ ] ゼロパディングしてた理由
    - [ ] エディタで表示されるファイルが辞書順で整数順ではなくて不便だった
    - [ ] メモ
  - [ ] 状態変数で管理するメリット
    - [ ] 擬多次元配列を使う時に引数が少なく済む
  - [ ] 将来的に，状態変数を文字列ではなくpartのような配列として管理したい
      配列を使えばもっとメタ的操作ができそう

    
ファイルの数が変わったら

増減に関わるファイルを探す
探すために名前を控える
控えた名前と現在の名前を比較
第一周と変更後の周回のみ名前を上書きする
名前のリストが必要
最後まで探し切る
for文の中で，何周目なのか知るためにインクリメント必要？
名称変更を考えると，増えたファイルと減ったファイル両方考えないといけない

# 配列を比較
  # 引数は比べる二つの配列
  # 引数の順番に意味を持たせる
# 配列を記録
  # 異なる要素を割り出し，要素のインデックスを記録する 
    # ファイル数が増減する前後でインデックスがズレた場合，どっちのバッファーを参照すればいいかわからなくなる
      # 要素のインデックスではなく名前を記録する
        # せっかく場合分けするんだからインデックスで記録する
        # ファイル増えたらcurrent_index参照，ファイル減ったらprevious_index参照
        # 更新する前にビルドスクリプトを呼ぶから情報は保持される
        # ファイル数が変わらない状態，増えた数と減った数が等しい場合がある
        # リネームとか
  # 増減したファイル・変更されたファイルに対応する処理を分ける予定はないが，一応分けて記録する
    # 二つの記録の重複はビルドスクリプト側で処理する
  # modeによって記録する配列を変える

-->
  
ビルドスクリプト

- 前処理
  - 強制改行に問題があった気がする
  - 前処理はビルドスクリプトから分離したい
- 差分
  - LaTeXdiffをもっと使いやすくする
  - gitdiff使ったことない
- 